'use client';

import { usePathname } from 'next/navigation';
import Footer from '../components/layout/Footer';
import Sidebar from '../components/layout/Sidebar';
import AdminNav from '../components/layout/adminNav';
import './globals.css';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { io } from "socket.io-client";
import { useNotificationData, useWebSocket } from '../Store/useAdminStore';
import { useEffect } from 'react';

const queryClient = new QueryClient();


// export const metadata = {
//   title: "Sealium",
//   description: "Generated by create next app",
// };
export default function RootLayout({ children }) {
  const pathname = usePathname();
  const {setSocket} = useWebSocket();
  const {setNotification} = useNotificationData();

  useEffect(() => {
    // connect to backend WebSocket
    const socket = io('https://api.sealiumback.store', {
      transports: ["websocket"], // force pure WebSocket, skip long polling
    });
    console.log('socketconnect', socket)
    setSocket(socket)
  
    // when connected
    socket.on("connect", () => {
      console.log("Connected with id:", socket.id);
    });
  
    // listen for notifications
    socket.on("receiveNotification", (data) => {
      console.log("ğŸ”” Notification:", data);
      setNotification(data)
    });
  
    // listen for messages
    socket.on("receiveMessage", (data) => {
      console.log("ğŸ’¬ Message:", data);
    });
  
    // cleanup on component unmount
    return () => {
      socket.disconnect();
    };
  }, []);
  

  const hideLayout =
    pathname === '/' || pathname === '/admin/signup' || pathname === '/reset-password';

  return (
    <html lang="ko">
      <head>
        {/* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ì„ ìœ„í•œ CSS ì¶”ê°€ */}
        <style jsx global>{`
          /* ì „ì²´ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
          ::-webkit-scrollbar {
            width: 15px; /* ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ */
          }
          
          /* ìŠ¤í¬ë¡¤ë°” íŠ¸ë™(ë°°ê²½) ìŠ¤íƒ€ì¼ */
          ::-webkit-scrollbar-track {
            // background-color: #FAFCFF; /* bg-amber-500ê³¼ ë¹„ìŠ·í•œ ìƒ‰ìƒ */
            border-radius: 15px 15px 15px 15px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
          }
          
          /* ìŠ¤í¬ë¡¤ë°” ì¸(ë“œë˜ê·¸í•˜ëŠ” ë¶€ë¶„) ìŠ¤íƒ€ì¼ */
          ::-webkit-scrollbar-thumb {
            background-color:  #7797AC; /* bg-amber-600ê³¼ ë¹„ìŠ·í•œ ìƒ‰ìƒ */
            border-radius: 8px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            border: 2px solid #D9D8D5; /* íŠ¸ë™ê³¼ êµ¬ë¶„ë˜ëŠ” í…Œë‘ë¦¬ */
          }
          
          /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ìŠ¤í¬ë¡¤ë°” ì¸ ìŠ¤íƒ€ì¼ */
          ::-webkit-scrollbar-thumb:hover {
            background-color: #2A4259; /* bg-amber-700ê³¼ ë¹„ìŠ·í•œ ìƒ‰ìƒ */
          }
        `}</style>
      </head>
      <body  >
        <QueryClientProvider client={queryClient}>
          {hideLayout ? (
            <>{children}</>
          ) : (
            <div className='w-screen h-[100vh] bg-deepnavy' >
              <div className='    h-[100vh] border-12 overflow-y-scroll overflow-hidden  border-deepnavy  '>
                {/* <div className=' overflow-y-scroll h-[calc(100vh-24px)]' > */}
                  <div className="flex min-h-screen">
                    <Sidebar />
                    <div className="flex flex-col flex-1">
                      {/* ì „ì—­ ìƒë‹¨ AdminNav */}
                      <AdminNav />
                      <main className="flex-1">{children}</main>
                      {/* <Footer /> */}
                    </div>
                  </div>
                </div>
              {/* </div> */}
            </div>)}
        </QueryClientProvider>
      </body>
    </html>
  );
}
